---
title: activiti-用户与组及部署管理
date: 2018-08-19 16:20:22
updated: 2018-08-19 16:20:22
tags: 
 -user
 -group
categories: activiti
comments: true
---

* **用户**和**组**主要是应用于 **用户任务**
* ``IdentityService ``接口

#### 用户 

```java
IdentityService identityService = activiti.getIdtityService();
//创建
User user = identityService.newUser("userName");
//保存
identityService.saveUser(user);
//查询
User userInDb = identityService.createUserQuery().userId("userName").singleResult();
//删除用户
identityService.deleteUser("userName");
```

<!--more-->

#### 组

```java
IdentityService identityService = activiti.getIdtityService();
//创建
Group group = identityService.newGroup("groupName");
//保存
identityService.saveGroup(user);
//查询
List<Group> groupList = identityService.createGroupQuery().groupId("name").list()
//删除用户
identityService.deleteGroup("name");
```

#### 用户与组关系

```java
//创建用户、创建组
...
//将用户加入组
identityService.createMembership("userName","groupName");
//查询组下用户
List<User> userList = identityService.createUserQuery().memberOfGroup("groupName").list();
//查询用户所属的组
Group group = identityService.createGroupQuery().groupMember("userName").singleResult();
```

#### 用户任务中的用户与组

* 将任务指定给多个候选人或候选组

* 候选组 `activiti:candidateGroups`

* 候选人 `activiti:cadidateUsers`

  ```java
  //xml 设置候选组
  <userTask activiti:candidateGroups="groupName1,groupName2" />
  //xml 设置候选人
  <userTask activiti:candidateUsers="userName1,userName2" />
  //查询候选人任务
  Task task = taskService.createTaskQuery().taskCandidateUser("userName").singleResult();
  //签收任务
  taskService.claim(taskId,"userName");
  //完成任务
  taskService.complete(taskId);
  ```

#### 部署流程资源

* 流程定义文件：.bpmn.xml

* 流程定义的图片：.png

* 表单文件：.form

* 规则文件：.drl

* 流程部署方式：

  * classpath

    ```java
    DeploymentBuilder deploymentBuilder = repositoryService.createDeployment();
    deploymentBuilder.addClasspathResource("classPath");
    deploymentBuilder.deploy();
    ```

  * InputStream

    ```java
    FileInputStream fileInputStream = new FileInputStream("filePath");
    repositoryService.createDeployment()
        .addInputStream("processTask.bpmn",fileInputStream).deploy();
    ```

  * 字符串

    ```java
    repositoryService.createDeployment()
        .addString("processTask.bpmn",text).deploy();
    ```

  * zip压缩包

    ```java
    //读取流
    InputStream zipStream = getClass().getClassLoader().getResourceAsStream("filePath");
    //解压缩、挨个部署，相当于for
    repositoryService.createDeployment()
        .addZipInputStream(new ZipInputStream(zipStream)).deploy();
    ```

  * 查询流程定义

    ```java
    ProcessDefinitionQuery process = repositoryService.createProcessDefinitionQuery();
    //查询单个
    long count = process.processDefinitionKey("bpmnName");
    //查询多个
    List<ProcessDefinition> definitionList = process.list();
    //读取
    ProcessDefinition definition = process.singleResult();
    String resourceName = definition.getDiagramResourceName();
    ```

  * 删除部署

    ```java
    repositoryService.deleteDeployment(deploymentId,true);
    ```

    





















